!function e(t,n,i){function s(a,d){if(!n[a]){if(!t[a]){var r="function"==typeof require&&require;if(!d&&r)return r(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return s(n?n:e)},l,l.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)s(i[a]);return s}({1:[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{"default":e}}var s=e("./video"),o=i(s),a=e("./videoquanda"),d=i(a);o["default"].videoQuanda=d["default"],d["default"].videoPlayer=o["default"]},{"./video":3,"./videoquanda":4}],2:[function(e,t,n){"use strict";function i(){return Math.round(new Date/1e3)}function s(e){return e.replace(/(\r\n|\n\r|\r|\n)/g,"<br/>")}function o(e){return e.replace(/<br\/?>/gi,"\r\n")}function a(e){return e.replace(/<img([^>]+)src="(.*?)"([^>]*)>/gi,"$2")}function d(e){return e.replace(/(<([^>]+)>)/gi,"")}Object.defineProperty(n,"__esModule",{value:!0}),n.time=i,n.lineBreakToTag=s,n.tagToLineBreak=o,n.imgTagToSrcAttr=a,n.removeAllTags=d},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i={videoElement:$("#jquery_jplayer_1"),files:{},init:function(){if(0!==this.videoElement.length){var e=this.videoElement;if($(e).find(".source").each(function(){var e=$(this).data("video-type");"mp4"===e&&(e="m4v"),i.files[e]=$(this).attr("data-src")}),0!==Object.keys(this.files).length)var t=Object.keys(this.files).join(",");e.jPlayer({ended:function(){},error:function(t){e.find("#notification").length||e.append('<span id="notification"/>'),t.jPlayer.status.srcSet!==!0&&e.find("#notification").text("Error ["+t.jPlayer.error.type+"]: "+t.jPlayer.error.message)},loadedmetadata:function(){var e=$("#jp_container_1").width(),t=$("video").get(0).videoHeight/($("video").get(0).videoWidth/e);$(this).jPlayer("option","size",{width:e,height:t})},pause:function(){},play:function(){},ready:function(){$(this).jPlayer("setMedia",i.files)},timeupdate:function(t){0!==t.jPlayer.status.readyState&&(e.find("#notification").hide(),"undefined"!=typeof i.videoQuanda&&i.videoQuanda.timeUpdate())},preload:"auto",solution:"html, flash",supplied:t,swfPath:"/mod/videoquanda/static/js/"})}},pause:function(e){this.videoElement.jPlayer("pause",e)},play:function(e){this.videoElement.jPlayer("play",e)},convertTime:function(e){return $.jPlayer.convertTime(e)},currentTime:function(){return"undefined"!=typeof this.videoElement.data().jPlayer?this.videoElement.data().jPlayer.status.currentTime:void 0},status:function(){return this.videoElement.data().jPlayer.status}};i.init(),n["default"]=i,t.exports=n["default"]},{}],4:[function(e,t,n){"use strict";function i(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}Object.defineProperty(n,"__esModule",{value:!0});var s=e("./lib"),o=i(s),a={init:function(){this.requestAndUpdateQuestionsAndAnswers()},log:function(){},addAnswerToDOM:function(e){var t=Object.keys(e);if("undefined"==typeof t||"undefined"!=typeof t&&"id,questionid,userid,timecreated,timemodified,text,username"!==t.join(","))return this.log("Data is empty or not valid.");if(e.text=o.lineBreakToTag(e.text),0!==$("#answer-"+e.id).length)return $("#answer-"+e.id).find(".answer-text").html(e.text).end().addClass("updated").find(".answer-post-date").text("| "+e.timemodified),this.log("Answer %s has already been loaded!",e.id);var n=this.answerTemplate.clone().attr("id","answer-"+e.id).data(e).find(".answer-text").html(e.text).end().find(".answer-author").text(e.username).end().find(".answer-post-date").text("| "+e.timemodified).end().insertAfter($("#right-question-"+e.questionid+" .answers .answer-header")).slideDown("slow");"1"!==$("#is-guest").val()&&("1"===$("#can-manage").val()||$("#userid").val()===e.userid)&&(a.log("You can manage answer %s",e.id),a.manageButtons.clone().insertBefore(n.find(".edit-input"))),n.closest(".answers").show()},addQuestionToDOM:function(e){var t=Object.keys(e);if("undefined"==typeof t||"undefined"!=typeof t&&!t.join(",").match("id,userid,timecreated,timemodified,seconds,text,username"))return this.log("Data is empty or not valid.",t.join(","));e.text=o.lineBreakToTag(e.text);var n=e.text.length>120?e.text.substring(0,120)+"...":e.text;return 1===$("#left-question-"+e.id).length?($("#left-question-"+e.id).find(".question-text").html(n).end().addClass("updated"),$("#right-question-"+e.id).find(".question-text").html(e.text).end().addClass("updated").find(".question-post-date").text(e.timemodified),this.log("Question %s has already been loaded. Only updating.",e.id)):void $(["left","right"]).each(function(t,i){var s=$("."+i).find(".questions"),o=("."+i==".left"?a.questionTemplateSmall:a.questionTemplateBig).clone().attr({id:i+"-question-"+e.id,seconds:+e.seconds}).data(e),d="undefined"!=typeof a.videoPlayer?a.videoPlayer.convertTime(+e.seconds):+e.seconds;if(o.find(".question-text").html("left"===i?n:e.text).end().find(".question-author").text(e.username).end().find(".question-post-date").text(e.timemodified).end().find(".seconds").text(d),"1"!==$("#is-guest").val()&&("1"===$("#can-manage").val()||$("#userid").val()===e.userid)&&(a.log("You can manage question %s",e.id),a.manageButtons.clone().prependTo(o.find(".question-content"))),0===s.find(".question").length)o.appendTo(s);else{var r=s.find(".question").filter(function(){return $(this).data("seconds")>=+e.seconds}),u=r.length;u?(r=u>1?"left"===i?r[0]:r[u-1]:r.get(0),o["left"===i?"insertBefore":"insertAfter"](r)):"left"===i?o.insertAfter(s.find(".question:last-child")):"right"===i&&o.prependTo(s)}("left"===i||a.seconds===+e.seconds||a.revealAllClicked===!0)&&o.show()})},requestDeleteQuestionOrAnswer:function(e){var t=$(e.target),n=t.closest(".question").data("id"),i=1===t.closest(".answer").length?"answer":"question";return"answer"===i&&(n+="/answers/"+t.closest(".answer").data("id")),confirm(M.util.get_string("confirm_delete_"+("answer"===i?"answer":"question"),this.plugin))?void a.sendDataToApi("DELETE",null,n,function(){var e=i+"-"+t.closest("."+i).data("id");$('[id$="'+e+'"]').fadeOut("slow",function(){$(this).remove(),a.updateDOMElements()})}):this.log("User chose not to delete.")},requestAndUpdateQuestionsAndAnswers:function(e){return"undefined"!=typeof e&&"number"!=typeof e?this.log(e+" is a wrong value for seconds parameter"):void this.requestDataFromApi(e,function(e){"object"==typeof e&&($.each(e,function(e,t){a.addQuestionToDOM(t),t.answers.length&&$.each(t.answers,function(e,t){a.addAnswerToDOM(t)})}),$(".question:not(.updated), .answer:not(.updated)").fadeOut("slow",function(){$(this).remove()}),$(".question.updated, .answer.updated").removeClass("updated"),a.updateDOMElements(),setTimeout(function(){a.requestAndUpdateQuestionsAndAnswers()},1e4))})},requestDataFromApi:function(e,t,n){return this.instanceId?("number"==typeof e&&(e=e.toString()),e="string"==typeof e&&""!==e?"/"+e.replace(/^\//,""):"",this.timeUpdated=o.time(),void $.ajax({url:this.baseApiRoute+this.instanceId+"/questions"+e,method:"GET",dataType:"JSON",cache:!1,success:function(e){"undefined"!=typeof t&&"function"==typeof t&&t(e)},error:function(e){if(405===e.status&&"undefined"!=typeof e.responseText){var t=JSON.parse(e.responseText);return alert(t.message)}"undefined"!=typeof n&&n("Error: ",e)}})):this.log("Abort: No instanceId found.")},sendDataToApi:function(e,t,n,i,s){return e&&e.match(/^(POST|PUT|DELETE)$/)?this.instanceId?("number"==typeof n&&(n=n.toString()),n="string"==typeof n&&""!==n?"/"+n.replace(/^\//,""):"",null!==this.ajaxSendCall&&(this.ajaxSendCall.abort(),this.log("Aborting send request. call: ",this.ajaxSendCall)),void(this.ajaxSendCall=$.ajax({url:this.baseApiRoute+this.instanceId+"/questions"+n,type:e,data:JSON.stringify(t||{}),dataType:"JSON",cache:!1,success:function(e){"undefined"!=typeof i&&"function"==typeof i&&i(e)},error:function(e){if(405===e.status&&"undefined"!=typeof e.responseText){var t=JSON.parse(e.responseText);return alert(t.message)}"undefined"!=typeof s&&s("Error: ",e)}}))):this.log("Abort: No instanceId found."):this.log('Abort: No or wrong method "'+e+'"')},scrollToActiveQuestion:function(){var e=$(".right .questions .question.active").position().top+$(".right .questions").scrollTop();$(".right .questions").stop().animate({scrollTop:e})},timeUpdate:function(){"undefined"!=typeof a.videoPlayer&&(this.currentVideoTime=Math.floor(a.videoPlayer.currentTime()),this.seconds=this.currentVideoTime,this.convertedSeconds=a.videoPlayer.convertTime(a.videoPlayer.currentTime())),0!==$('.question[seconds="'+this.seconds+'"]').length&&($(".question").removeClass("active"),$('.left .question[seconds="'+this.seconds+'"]:last, .right .question[seconds="'+this.seconds+'"]:first').addClass("active"),$(".left, .right").find('.question[seconds="'+this.seconds+'"]').slideDown("slow",function(){a.scrollToActiveQuestion()}))},updateDOMElements:function(){var e=$(".left .question").length;$("#no-questions-message")[e>=1?"fadeOut":"fadeIn"](),$("#load-all-questions")[e>1?"fadeIn":"fadeOut"](),$(".right .question .answers").each(function(){var e=$(this).find(".answer").length,t=e+" "+M.util.get_string(1===e?"answer":"answers",a.plugin);$("#left-question-"+$(this).closest(".question").data("id")+" .question-answer-count").text("("+t+")")})},validateAndSubmitInput:function(e,t){var n=$(e.target),i=n.is(".submit-question")?"question":"answer",s=$.trim(n.siblings("textarea").val()),o=n.closest(".answer").data("id"),d=n.closest(".question").data("id"),r="",u={text:s};return s.length<10?(n.siblings("textarea").focus(),alert(M.util.get_string("notify_empty_"+i,this.plugin))):("PUT"===t&&(i=n.is(".edit-question")?"question":"answer",r=d),"answer"===i&&(r=d+"/answers","undefined"!=typeof o&&"PUT"===t&&(r+="/"+o)),"POST"===t&&"question"===i&&(u.seconds=this.seconds),n.prop("disabled","disabled"),void this.sendDataToApi(t,u,r,function(){a.requestAndUpdateQuestionsAndAnswers(),$(".textarea-"+i).val(""),n.removeProp("disabled"),"PUT"===t&&($(".edit-input").hide(),$(".text").show(),$(".author").show()),n.siblings("textarea").blur(),a.wasPaused===!1&&a.videoPlayer.play()}))},ajaxSendCall:null,answerTemplate:jQuery(".answers .answer").detach(),baseApiRoute:M.cfg.wwwroot+"/videoquanda/api/v1/",convertedSeconds:"00:00",currentVideoTime:-1,instanceId:$("#instanceid").val(),manageButtons:$(".right .question .manage-buttons").detach(),plugin:"mod_videoquanda",questionTemplateSmall:$(".left .questions .question").detach(),questionTemplateBig:$(".right .questions .question").detach(),revealAllClicked:!1,seconds:0,timeUpdated:0,to:null,wasPaused:!1};$(document).on("click",".submit-question, .submit-answer",function(e){a.validateAndSubmitInput(e,"POST")}),$(document).on("click",".edit-question, .edit-answer",function(e){a.validateAndSubmitInput(e,"PUT")}),$(document).on("click","button.edit-button",function(){var e=1!==$(this).closest(".answer").length?"question":"answer",t="question"===e?$(this).closest(".question-content"):$(this).closest(".answer-content"),n=o.removeAllTags(o.imgTagToSrcAttr(o.tagToLineBreak(t.find(".text").html())));$(".edit-input").hide(),$(".text, .answer-author").show(),t.find(".text, .answer-author").toggle().end().find(".edit-input").toggle().find("textarea").focus().val(n)}),$(document).on("click","button.delete-button",function(e){a.requestDeleteQuestionOrAnswer(e)}),$(document).on("click",".left .question, .right .question .seconds",function(){var e=0+($(this).is(".question")?$(this):$(this).closest(".question")).data("seconds");$(".question").removeClass("active");var t=$(this).closest(".question").data("id");$('[id$="question-'+t+'"]').addClass("active"),a.scrollToActiveQuestion(),"undefined"!=typeof a.videoPlayer&&(a.videoPlayer.pause(e),$("body").scrollTop()>$("#videoquanda-activity").position().top&&$("body").stop().animate({scrollTop:$("#videoquanda-activity").position().top}))}),$(document).on("click","#load-all-questions a",function(){$(".right .question").slideDown("slow"),a.revealAllClicked=!0}),$(document).on("focus","textarea",function(){"undefined"!=typeof a.videoPlayer&&(a.wasPaused=a.videoPlayer.status().paused,a.videoPlayer.pause()),$(this).is(".textarea-question")&&$("#question-time").show().find(".seconds").text(a.convertedSeconds)}).on("blur","textarea",function(){"undefined"!=typeof a.videoPlayer&&a.wasPaused===!1&&a.videoPlayer.play()}),a.init(),n["default"]=a,t.exports=n["default"]},{"./lib":2}]},{},[1]);